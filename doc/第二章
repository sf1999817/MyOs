### 第2章：编写MBR主引导记录

#### BIOS全称叫基本输入输出系统。

这里计算机在加电自检时，肯定是直接跟cpu打交道，这里内存访问模式是实模式，即：段基址+偏移地址

查表：0xF0000~0XFFFFF，这64KB的内存是ROM，这里面存储的是BIOS的代码，BIOS的主要工作就是检测、初始化硬件。硬件自己提供了一些初始化的功能调用，BIOS直接调用就可以了。BIOS还建立了中断向量表。这样就可以通过“int 中断号”来实现相关的硬件调用。BIOS建立的这些功能就是对硬件的IO操作，也就是输入输出，但由于就64KB大小的空间，不可能把所有硬件的IO操作实现得面面俱到。

在开机的一瞬间，也就是接电的一瞬间，CPU的cs:ip寄存器被强制初始化为：0xF000：0xFFF0。由于开机的时候处于实模式。BIOS是在实模式下运行的，而实模式只能访问1MB空间（20位地址线，2的20次方是1MB）

这里BIOS的执行就是，CPU就访问这个0xF000：0xFFF0地址，找到这个地址，发现存储的是jmp far f000：e05b跳转指令，占16字节。

接下来BIOS便检测内存、显卡等外设信息。当检测通过，并初始化好硬件以后，开始在内存中0x000~0x3FF处建立数据结构，中断向量表IVT并填写中断例程。

BIOS的任务执行完后，最后一个工作内容就是将MBR加载到内存0X7C00处，（至于为什么是这个内存，书上有详细的解释）。

BIOS要将磁盘里面第一个扇区里面的内容加载到0x7c00，它怎么识别是哪个扇区呢？（魔数：0x55和0xaa。）

识别出来以后，它同样也是通过jmp 0：0x7c00，将mbr加载到内存里面。

#### 总结：

bios本身就是一段程序，rom里面存储了，bios 的入口地址，rom 内存的访问这个时候是实模式，段基址+段内偏移。

这个时候通过cs：ip ，（指向这个bios 的入口地址）然后去执行这个bios 程序，加电自检，处理完硬件后，再接着构建中断向量表。

接着bios 完成自己的使命以后，进行最后一项工作，检验磁盘第一个扇区的内容，这就是mbr ，mbr 最后2字节，魔数0x55和0xaa为了识别mbr，接着bios 把第一个扇区加载到0x7c00。

所以bios其实是把这个mbr内容，直接复制到了这个0x7c00这个内存的位置，然后BIOS将控制权转移到了这个0x7c00地址，开始执行这个刚刚加载的MBR代码。

